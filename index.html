<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concrete Testing System - Multi-Site</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Login Screen */
        .login-screen {
            background: white;
            border-radius: 15px;
            padding: 60px 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 450px;
            margin: 100px auto;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-screen h1 {
            color: #2c3e50;
            font-size: 32px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .login-screen p {
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.4);
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
            border-left: 4px solid #dc3545;
        }
        
        .password-hint {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Dashboard Screen */
        .dashboard-screen {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease;
        }
        
        .dashboard-screen.active {
            display: block;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #3498db;
        }
        
        .dashboard-header h1 {
            color: #2c3e50;
            font-size: 28px;
        }
        
        .site-badge-large {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
        }
        
        .logout-btn-dash {
            background: #e74c3c;
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .logout-btn-dash:hover {
            background: #c0392b;
        }
        
        .action-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .action-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            border: 3px solid transparent;
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
            border-color: rgba(255,255,255,0.3);
        }
        
        .action-card.view-data {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }
        
        .action-card-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .action-card h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .action-card p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        /* Data Entry Form */
        .data-entry-screen {
            display: none;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .data-entry-screen.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid white;
            padding: 10px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: white;
            color: #2c3e50;
        }
        
        .site-info {
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .form-container {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            font-size: 20px;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
            font-weight: 600;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .required {
            color: #e74c3c;
            margin-left: 3px;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .unit {
            font-size: 12px;
            color: #7f8c8d;
            margin-left: 5px;
        }
        
        .btn-container {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button[type="submit"], button[type="reset"], button[type="button"] {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button[type="submit"] {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        button[type="submit"]:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        button[type="reset"] {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        button[type="reset"]:hover {
            background: #bdc3c7;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .help-text {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 3px;
        }
        
        /* Data Viewer */
        .data-viewer-screen {
            display: none;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .data-viewer-screen.active {
            display: block;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding-left: 40px;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }
        
        .refresh-btn, .export-btn {
            padding: 12px 20px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .refresh-btn {
            background: #3498db;
        }
        
        .export-btn {
            background: #27ae60;
        }
        
        .refresh-btn:hover {
            background: #2980b9;
        }
        
        .export-btn:hover {
            background: #229954;
        }
        
        .stats-bar {
            background: #ecf0f1;
            padding: 15px 30px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        .data-content {
            padding: 30px;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: #7f8c8d;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            position: sticky;
            top: 0;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 14px;
            color: #2c3e50;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .no-data {
            text-align: center;
            padding: 60px;
            color: #7f8c8d;
        }
        
        .no-data-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .strength-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .strength-low { background: #fee; color: #c00; }
        .strength-medium { background: #ffeaa7; color: #d63031; }
        .strength-high { background: #d4edda; color: #155724; }
        
        /* Action Buttons in Table */
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .btn-edit, .btn-delete {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-edit {
            background: #3498db;
            color: white;
        }
        
        .btn-edit:hover {
            background: #2980b9;
        }
        
        .btn-delete {
            background: #e74c3c;
            color: white;
        }
        
        .btn-delete:hover {
            background: #c0392b;
        }
        
        /* Edit Mode Indicator */
        .edit-mode-badge {
            display: inline-block;
            background: #f39c12;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        /* Modal for Confirmations */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        .modal-header {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .modal-body {
            color: #7f8c8d;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .modal-btn-confirm {
            background: #e74c3c;
            color: white;
        }
        
        .modal-btn-cancel {
            background: #ecf0f1;
            color: #2c3e50;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div class="login-screen" id="loginScreen">
            <h1>üîê Site Login</h1>
            <p>Enter your credentials to access the system</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="siteId">Site ID</label>
                    <select id="siteId" required>
                        <option value="">Select your site</option>
                        <option value="Site-A">Site-A</option>
                        <option value="Site-B">Site-B</option>
                        <option value="Site-C">Site-C</option>
                        <option value="Site-D">Site-D</option>
                        <option value="Site-E">Site-E</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter site password" required>
                    <div class="password-hint">Default: siteA123, siteB123, etc.</div>
                </div>
                
                <button type="submit" class="login-btn">Login</button>
                
                <div class="error-message" id="errorMessage"></div>
            </form>
        </div>
        
        <!-- Dashboard Screen -->
        <div class="dashboard-screen" id="dashboardScreen">
            <div class="dashboard-header">
                <div>
                    <h1>üèóÔ∏è Concrete Testing System</h1>
                    <div class="site-badge-large" id="dashboardSiteBadge">Site: -</div>
                </div>
                <button class="logout-btn-dash" id="logoutBtnDash">Logout</button>
            </div>
            
            <div class="action-cards">
                <div class="action-card" id="enterDataCard">
                    <div class="action-card-icon">üìù</div>
                    <h2>Enter New Data</h2>
                    <p>Submit new concrete testing data</p>
                </div>
                
                <div class="action-card view-data" id="viewDataCard">
                    <div class="action-card-icon">üìä</div>
                    <h2>View & Edit Data</h2>
                    <p>View, edit, and export historical test records</p>
                </div>
            </div>
        </div>
        
        <!-- Data Entry Screen -->
        <div class="data-entry-screen" id="dataEntryScreen">
            <div class="header">
                <div class="header-content">
                    <div>
                        <h1 id="formTitle">üìù Enter Testing Data</h1>
                        <div class="site-info" id="entrySiteBadge">Site: -</div>
                    </div>
                    <button class="back-btn" id="backBtn">‚Üê Back to Dashboard</button>
                </div>
            </div>
            
            <div class="form-container">
                <div id="editModeBadge" style="display: none;" class="edit-mode-badge">
                    ‚úèÔ∏è EDIT MODE - Updating existing record
                </div>
                
                <form id="dataForm">
                    <!-- Hidden field for row number (used in edit mode) -->
                    <input type="hidden" id="rowNumber" value="">
                    
                    <!-- Basic Information -->
                    <div class="section">
                        <div class="section-title">Basic Information</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="sampleId">Sample ID <span class="required">*</span></label>
                                <input type="text" id="sampleId" required placeholder="e.g., SA-001">
                                <div class="help-text">Unique identifier for this sample</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="mixDesign">Mix Design <span class="required">*</span></label>
                                <input type="text" id="mixDesign" required placeholder="e.g., M25">
                                <div class="help-text">Concrete mix designation</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cementType">Cement Type</label>
                                <select id="cementType">
                                    <option value="">Select cement type</option>
                                    <option value="OPC 43">OPC 43</option>
                                    <option value="OPC 53">OPC 53</option>
                                    <option value="PPC">PPC</option>
                                    <option value="PSC">PSC</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="testedBy">Tested By</label>
                                <input type="text" id="testedBy" placeholder="Engineer name">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mix Proportions -->
                    <div class="section">
                        <div class="section-title">Mix Proportions</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="cementKg">Cement <span class="unit">(kg)</span></label>
                                <input type="number" id="cementKg" step="0.01" placeholder="0.00">
                            </div>
                            
                            <div class="form-group">
                                <label for="waterKg">Water <span class="unit">(kg)</span></label>
                                <input type="number" id="waterKg" step="0.01" placeholder="0.00">
                            </div>
                            
                            <div class="form-group">
                                <label for="aggregateFineKg">Fine Aggregate <span class="unit">(kg)</span></label>
                                <input type="number" id="aggregateFineKg" step="0.01" placeholder="0.00">
                            </div>
                            
                            <div class="form-group">
                                <label for="aggregateCoarseKg">Coarse Aggregate <span class="unit">(kg)</span></label>
                                <input type="number" id="aggregateCoarseKg" step="0.01" placeholder="0.00">
                            </div>
                            
                            <div class="form-group">
                                <label for="admixtureType">Admixture Type</label>
                                <select id="admixtureType">
                                    <option value="">None</option>
                                    <option value="Plasticizer">Plasticizer</option>
                                    <option value="Superplasticizer">Superplasticizer</option>
                                    <option value="Retarder">Retarder</option>
                                    <option value="Accelerator">Accelerator</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="admixtureMl">Admixture Quantity <span class="unit">(ml)</span></label>
                                <input type="number" id="admixtureMl" step="0.1" placeholder="0.0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Test Results -->
                    <div class="section">
                        <div class="section-title">Test Results</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="compressiveStrength">Compressive Strength <span class="unit">(MPa)</span></label>
                                <input type="number" id="compressiveStrength" step="0.1" placeholder="0.0">
                            </div>
                            
                            <div class="form-group">
                                <label for="testAgeDays">Test Age <span class="unit">(days)</span></label>
                                <select id="testAgeDays">
                                    <option value="">Select age</option>
                                    <option value="7">7 days</option>
                                    <option value="14">14 days</option>
                                    <option value="28">28 days</option>
                                    <option value="56">56 days</option>
                                    <option value="90">90 days</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="slump">Slump <span class="unit">(mm)</span></label>
                                <input type="number" id="slump" step="1" placeholder="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="flow">Flow <span class="unit">(mm)</span></label>
                                <input type="number" id="flow" step="1" placeholder="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="shrinkage">Shrinkage <span class="unit">(%)</span></label>
                                <input type="number" id="shrinkage" step="0.001" placeholder="0.000">
                            </div>
                            
                            <div class="form-group">
                                <label for="elasticModulus">Elastic Modulus <span class="unit">(GPa)</span></label>
                                <input type="number" id="elasticModulus" step="0.1" placeholder="0.0">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Information -->
                    <div class="section">
                        <div class="section-title">Additional Information</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="curingCondition">Curing Condition</label>
                                <select id="curingCondition">
                                    <option value="">Select condition</option>
                                    <option value="Water Curing">Water Curing</option>
                                    <option value="Air Curing">Air Curing</option>
                                    <option value="Steam Curing">Steam Curing</option>
                                    <option value="Membrane Curing">Membrane Curing</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="notes">Notes</label>
                                <textarea id="notes" placeholder="Any additional observations or comments..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="btn-container">
                        <button type="submit" id="submitBtn">üíæ Save Data</button>
                        <button type="reset" id="resetBtn">üîÑ Reset Form</button>
                    </div>
                    
                    <div class="message" id="message"></div>
                </form>
            </div>
        </div>
        
        <!-- Data Viewer Screen -->
        <div class="data-viewer-screen" id="dataViewerScreen">
            <div class="header">
                <div class="header-content">
                    <div>
                        <h1>üìä Test Records</h1>
                        <div class="site-info" id="viewerSiteBadge">Site: -</div>
                    </div>
                    <button class="back-btn" id="backBtnViewer">‚Üê Back to Dashboard</button>
                </div>
            </div>
            
            <div class="controls">
                <div class="controls-grid">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Search by Sample ID, Mix Design...">
                    </div>
                    <button class="refresh-btn" id="refreshBtn">üîÑ Refresh Data</button>
                    <button class="export-btn" id="exportBtn">üì• Export to CSV</button>
                </div>
            </div>
            
            <div class="stats-bar" id="statsBar">
                <div class="stat-item">
                    <div class="stat-value" id="totalRecords">0</div>
                    <div class="stat-label">Total Records</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgStrength">0</div>
                    <div class="stat-label">Avg Strength (MPa)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgSlump">0</div>
                    <div class="stat-label">Avg Slump (mm)</div>
                </div>
            </div>
            
            <div class="data-content" id="dataContent">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading data...</p>
                </div>
            </div>
        </div>
        
        <!-- Delete Confirmation Modal -->
        <div class="modal" id="deleteModal">
            <div class="modal-content">
                <div class="modal-header">‚ö†Ô∏è Confirm Deletion</div>
                <div class="modal-body">
                    Are you sure you want to delete this record? This action cannot be undone.
                    <br><br>
                    <strong>Sample ID:</strong> <span id="deleteSampleId"></span>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-cancel" id="cancelDeleteBtn">Cancel</button>
                    <button class="modal-btn modal-btn-confirm" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const API_URL = 'https://script.google.com/macros/s/AKfycbzestrBYnXObfUGrCv1p3ig2E2lhOpf1RsI3oY3-Zywcq5oTkAN81SosEgJ_74IrNafng/exec'; // REPLACE THIS
        
        // Simple authentication (for demo - use proper auth in production)
        const SITE_PASSWORDS = {
            'Site-A': 'siteA123',
            'Site-B': 'siteB123',
            'Site-C': 'siteC123',
            'Site-D': 'siteD123',
            'Site-E': 'siteE123'
        };
        
        // ===== STATE =====
        let currentUser = {
            site: null,
            authenticated: false
        };
        
        let currentData = [];
        let editingRow = null;
        
        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            checkSession();
        });
        
        function initializeEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Dashboard
            document.getElementById('enterDataCard').addEventListener('click', showDataEntry);
            document.getElementById('viewDataCard').addEventListener('click', showDataViewer);
            document.getElementById('logoutBtnDash').addEventListener('click', logout);
            
            // Data Entry
            document.getElementById('dataForm').addEventListener('submit', handleSubmit);
            document.getElementById('backBtn').addEventListener('click', showDashboard);
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            
            // Data Viewer
            document.getElementById('backBtnViewer').addEventListener('click', showDashboard);
            document.getElementById('refreshBtn').addEventListener('click', loadData);
            document.getElementById('exportBtn').addEventListener('click', exportToCSV);
            document.getElementById('searchInput').addEventListener('input', filterData);
            
            // Delete Modal
            document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
        }
        
        // ===== AUTHENTICATION =====
        function handleLogin(e) {
            e.preventDefault();
            
            const site = document.getElementById('siteId').value;
            const password = document.getElementById('password').value;
            
            if (SITE_PASSWORDS[site] === password) {
                currentUser.site = site;
                currentUser.authenticated = true;
                
                sessionStorage.setItem('currentSite', site);
                sessionStorage.setItem('authenticated', 'true');
                
                showDashboard();
            } else {
                const errorMsg = document.getElementById('errorMessage');
                errorMsg.textContent = 'Invalid site or password';
                errorMsg.style.display = 'block';
            }
        }
        
        function checkSession() {
            const site = sessionStorage.getItem('currentSite');
            const authenticated = sessionStorage.getItem('authenticated');
            
            if (site && authenticated === 'true') {
                currentUser.site = site;
                currentUser.authenticated = true;
                showDashboard();
            }
        }
        
        function logout() {
            currentUser = { site: null, authenticated: false };
            sessionStorage.clear();
            
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('dashboardScreen').classList.remove('active');
            document.getElementById('password').value = '';
        }
        
        // ===== NAVIGATION =====
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboardScreen').classList.add('active');
            document.getElementById('dataEntryScreen').classList.remove('active');
            document.getElementById('dataViewerScreen').classList.remove('active');
            
            document.getElementById('dashboardSiteBadge').textContent = `Site: ${currentUser.site}`;
            
            // Reset edit mode
            editingRow = null;
            resetForm();
        }
        
        function showDataEntry() {
            document.getElementById('dashboardScreen').classList.remove('active');
            document.getElementById('dataEntryScreen').classList.add('active');
            
            document.getElementById('entrySiteBadge').textContent = `Site: ${currentUser.site}`;
        }
        
        function showDataViewer() {
            document.getElementById('dashboardScreen').classList.remove('active');
            document.getElementById('dataViewerScreen').classList.add('active');
            
            document.getElementById('viewerSiteBadge').textContent = `Site: ${currentUser.site}`;
            loadData();
        }
        
        // ===== DATA SUBMISSION =====
        async function handleSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = editingRow !== null ? '‚è≥ Updating...' : '‚è≥ Saving...';
            
            try {
                const formData = {
                    site_name: currentUser.site,
                    sample_id: document.getElementById('sampleId').value,
                    mix_design: document.getElementById('mixDesign').value,
                    cement_type: document.getElementById('cementType').value,
                    cement_kg: document.getElementById('cementKg').value,
                    water_kg: document.getElementById('waterKg').value,
                    aggregate_fine_kg: document.getElementById('aggregateFineKg').value,
                    aggregate_coarse_kg: document.getElementById('aggregateCoarseKg').value,
                    admixture_type: document.getElementById('admixtureType').value,
                    admixture_ml: document.getElementById('admixtureMl').value,
                    compressive_strength: document.getElementById('compressiveStrength').value,
                    test_age_days: document.getElementById('testAgeDays').value,
                    slump: document.getElementById('slump').value,
                    flow: document.getElementById('flow').value,
                    shrinkage: document.getElementById('shrinkage').value,
                    elastic_modulus: document.getElementById('elasticModulus').value,
                    curing_condition: document.getElementById('curingCondition').value,
                    tested_by: document.getElementById('testedBy').value,
                    notes: document.getElementById('notes').value
                };
                
                // If editing, add action and row number
                if (editingRow !== null) {
                    formData.action = 'update';
                    formData.row_number = editingRow;
                }
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                // Note: With no-cors, we can't read the response, but the request will complete
                showMessage('success', editingRow !== null ? 
                    'Data updated successfully! ‚úÖ' : 
                    'Data saved successfully! ‚úÖ');
                
                setTimeout(() => {
                    resetForm();
                    if (editingRow !== null) {
                        editingRow = null;
                        showDataViewer();
                    }
                }, 1500);
                
            } catch (error) {
                console.error('Error:', error);
                showMessage('error', 'Error: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = editingRow !== null ? 'üíæ Update Data' : 'üíæ Save Data';
            }
        }
        
        function resetForm() {
            document.getElementById('dataForm').reset();
            document.getElementById('rowNumber').value = '';
            document.getElementById('editModeBadge').style.display = 'none';
            document.getElementById('formTitle').textContent = 'üìù Enter Testing Data';
            document.getElementById('submitBtn').textContent = 'üíæ Save Data';
            editingRow = null;
            hideMessage();
        }
        
        function showMessage(type, text) {
            const message = document.getElementById('message');
            message.className = `message ${type}`;
            message.textContent = text;
            message.style.display = 'block';
        }
        
        function hideMessage() {
            document.getElementById('message').style.display = 'none';
        }
        
        // ===== DATA LOADING =====
        async function loadData() {
            const dataContent = document.getElementById('dataContent');
            dataContent.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading data...</p>
                </div>
            `;
            
            try {
                const response = await fetch(`${API_URL}?action=getData&site=${currentUser.site}`);
                const result = await response.json();
                
                if (result.status === 'success' && result.data) {
                    currentData = result.data.data || [];
                    displayData(currentData);
                    updateStats(currentData);
                } else {
                    dataContent.innerHTML = `
                        <div class="no-data">
                            <div class="no-data-icon">üì≠</div>
                            <h3>No data available</h3>
                            <p>Start by entering some test data</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading data:', error);
                dataContent.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">‚ùå</div>
                        <h3>Error loading data</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        function displayData(data) {
            const dataContent = document.getElementById('dataContent');
            
            if (!data || data.length === 0) {
                dataContent.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üì≠</div>
                        <h3>No data available</h3>
                        <p>Start by entering some test data</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Actions</th>
                                <th>Timestamp</th>
                                <th>Site</th>
                                <th>Sample ID</th>
                                <th>Mix Design</th>
                                <th>Cement Type</th>
                                <th>Cement (kg)</th>
                                <th>Water (kg)</th>
                                <th>Fine Agg. (kg)</th>
                                <th>Coarse Agg. (kg)</th>
                                <th>Admixture Type</th>
                                <th>Admixture (ml)</th>
                                <th>Strength (MPa)</th>
                                <th>Age (days)</th>
                                <th>Slump (mm)</th>
                                <th>Flow (mm)</th>
                                <th>Shrinkage (%)</th>
                                <th>Elastic Modulus (GPa)</th>
                                <th>Curing</th>
                                <th>Tested By</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach((row) => {
                const strengthBadge = getStrengthBadge(row.compressive_strength);
                const timestamp = new Date(row.timestamp).toLocaleString();
                
                tableHTML += `
                    <tr>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-edit" onclick="editRecord(${row.row_number})">‚úèÔ∏è Edit</button>
                                <button class="btn-delete" onclick="deleteRecord(${row.row_number}, '${row.sample_id}')">üóëÔ∏è Delete</button>
                            </div>
                        </td>
                        <td>${timestamp}</td>
                        <td>${row.site_name || '-'}</td>
                        <td><strong>${row.sample_id}</strong></td>
                        <td>${row.mix_design || '-'}</td>
                        <td>${row.cement_type || '-'}</td>
                        <td>${row.cement_kg || '-'}</td>
                        <td>${row.water_kg || '-'}</td>
                        <td>${row.aggregate_fine_kg || '-'}</td>
                        <td>${row.aggregate_coarse_kg || '-'}</td>
                        <td>${row.admixture_type || '-'}</td>
                        <td>${row.admixture_ml || '-'}</td>
                        <td>${strengthBadge || '-'}</td>
                        <td>${row.test_age_days || '-'}</td>
                        <td>${row.slump || '-'}</td>
                        <td>${row.flow || '-'}</td>
                        <td>${row.shrinkage || '-'}</td>
                        <td>${row.elastic_modulus || '-'}</td>
                        <td>${row.curing_condition || '-'}</td>
                        <td>${row.tested_by || '-'}</td>
                        <td>${row.notes || '-'}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            dataContent.innerHTML = tableHTML;
        }
        
        function getStrengthBadge(strength) {
            if (!strength) return '-';
            
            const val = parseFloat(strength);
            let className = 'strength-medium';
            
            if (val < 20) className = 'strength-low';
            else if (val >= 30) className = 'strength-high';
            
            return `<span class="strength-badge ${className}">${val} MPa</span>`;
        }
        
        function updateStats(data) {
            const totalRecords = data.length;
            
            let totalStrength = 0;
            let strengthCount = 0;
            let totalSlump = 0;
            let slumpCount = 0;
            
            data.forEach(row => {
                if (row.compressive_strength) {
                    totalStrength += parseFloat(row.compressive_strength);
                    strengthCount++;
                }
                if (row.slump) {
                    totalSlump += parseFloat(row.slump);
                    slumpCount++;
                }
            });
            
            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('avgStrength').textContent = 
                strengthCount > 0 ? (totalStrength / strengthCount).toFixed(1) : '0';
            document.getElementById('avgSlump').textContent = 
                slumpCount > 0 ? (totalSlump / slumpCount).toFixed(0) : '0';
        }
        
        // ===== EDIT FUNCTIONALITY =====
        function editRecord(rowNumber) {
            const record = currentData.find(r => r.row_number === rowNumber);
            
            if (!record) {
                alert('Record not found!');
                return;
            }
            
            // Populate form with existing data
            document.getElementById('sampleId').value = record.sample_id || '';
            document.getElementById('mixDesign').value = record.mix_design || '';
            document.getElementById('cementType').value = record.cement_type || '';
            document.getElementById('cementKg').value = record.cement_kg || '';
            document.getElementById('waterKg').value = record.water_kg || '';
            document.getElementById('aggregateFineKg').value = record.aggregate_fine_kg || '';
            document.getElementById('aggregateCoarseKg').value = record.aggregate_coarse_kg || '';
            document.getElementById('admixtureType').value = record.admixture_type || '';
            document.getElementById('admixtureMl').value = record.admixture_ml || '';
            document.getElementById('compressiveStrength').value = record.compressive_strength || '';
            document.getElementById('testAgeDays').value = record.test_age_days || '';
            document.getElementById('slump').value = record.slump || '';
            document.getElementById('flow').value = record.flow || '';
            document.getElementById('shrinkage').value = record.shrinkage || '';
            document.getElementById('elasticModulus').value = record.elastic_modulus || '';
            document.getElementById('curingCondition').value = record.curing_condition || '';
            document.getElementById('testedBy').value = record.tested_by || '';
            document.getElementById('notes').value = record.notes || '';
            
            // Set edit mode
            editingRow = rowNumber;
            document.getElementById('rowNumber').value = rowNumber;
            document.getElementById('editModeBadge').style.display = 'block';
            document.getElementById('formTitle').textContent = '‚úèÔ∏è Edit Testing Data';
            document.getElementById('submitBtn').textContent = 'üíæ Update Data';
            
            // Show data entry screen
            document.getElementById('dataViewerScreen').classList.remove('active');
            document.getElementById('dataEntryScreen').classList.add('active');
        }
        
        // ===== DELETE FUNCTIONALITY =====
        let deleteRowNumber = null;
        
        function deleteRecord(rowNumber, sampleId) {
            deleteRowNumber = rowNumber;
            document.getElementById('deleteSampleId').textContent = sampleId;
            document.getElementById('deleteModal').classList.add('active');
        }
        
        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('active');
            deleteRowNumber = null;
        }
        
        async function confirmDelete() {
            if (deleteRowNumber === null) return;
            
            const confirmBtn = document.getElementById('confirmDeleteBtn');
            confirmBtn.disabled = true;
            confirmBtn.textContent = 'Deleting...';
            
            try {
                const deleteData = {
                    action: 'delete',
                    site_name: currentUser.site,
                    row_number: deleteRowNumber
                };
                
                await fetch(API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(deleteData)
                });
                
                closeDeleteModal();
                
                // Reload data after a short delay
                setTimeout(() => {
                    loadData();
                }, 1000);
                
            } catch (error) {
                console.error('Error deleting:', error);
                alert('Error deleting record: ' + error.message);
            } finally {
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'Delete';
            }
        }
        
        // ===== SEARCH/FILTER =====
        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (!searchTerm) {
                displayData(currentData);
                return;
            }
            
            const filtered = currentData.filter(row => {
                return (
                    (row.sample_id && row.sample_id.toLowerCase().includes(searchTerm)) ||
                    (row.mix_design && row.mix_design.toLowerCase().includes(searchTerm)) ||
                    (row.cement_type && row.cement_type.toLowerCase().includes(searchTerm)) ||
                    (row.tested_by && row.tested_by.toLowerCase().includes(searchTerm))
                );
            });
            
            displayData(filtered);
        }
        
        // ===== EXPORT =====
        function exportToCSV() {
            if (!currentData || currentData.length === 0) {
                alert('No data to export');
                return;
            }
            
            const headers = [
                'Timestamp', 'Site Name', 'Sample ID', 'Mix Design', 'Cement Type',
                'Cement (kg)', 'Water (kg)', 'Fine Aggregate (kg)', 'Coarse Aggregate (kg)',
                'Admixture Type', 'Admixture (ml)', 'Compressive Strength (MPa)',
                'Test Age (days)', 'Slump (mm)', 'Flow (mm)', 'Shrinkage (%)',
                'Elastic Modulus (GPa)', 'Curing Condition', 'Tested By', 'Notes'
            ];
            
            let csv = headers.join(',') + '\n';
            
            currentData.forEach(row => {
                const values = [
                    new Date(row.timestamp).toLocaleString(),
                    row.site_name,
                    row.sample_id,
                    row.mix_design,
                    row.cement_type,
                    row.cement_kg,
                    row.water_kg,
                    row.aggregate_fine_kg,
                    row.aggregate_coarse_kg,
                    row.admixture_type,
                    row.admixture_ml,
                    row.compressive_strength,
                    row.test_age_days,
                    row.slump,
                    row.flow,
                    row.shrinkage,
                    row.elastic_modulus,
                    row.curing_condition,
                    row.tested_by,
                    row.notes
                ].map(v => `"${v || ''}"`);
                
                csv += values.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentUser.site}_concrete_data_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
